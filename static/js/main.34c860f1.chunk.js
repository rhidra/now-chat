(this["webpackJsonpnow-chat"]=this["webpackJsonpnow-chat"]||[]).push([[0],{38:function(e,t,n){e.exports=n(48)},43:function(e,t,n){},47:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=47},48:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),c=n(13),r=n.n(c),s=(n(43),n(9)),i=n(10),u=n(22),l=n(20),h=n(14),d=n(57),m=n(52),f=n(31),y=n(53),v=n(54),p=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={value:""},a.handleChange=a.handleChange.bind(Object(h.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(h.a)(a)),a.handleKeyDown=a.handleKeyDown.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.onSubmit(this.state.value),this.setState({value:""})}},{key:"handleKeyDown",value:function(e){"Enter"!==e.key||e.shiftKey||this.handleSubmit(e)}},{key:"render",value:function(){return o.a.createElement(d.a,{onSubmit:this.handleSubmit},o.a.createElement(m.a,null,o.a.createElement(f.a,{as:"textarea",rows:"1",value:this.state.value,onChange:this.handleChange,onKeyDown:this.handleKeyDown,disabled:"connected"!==this.props.status}),o.a.createElement(m.a.Append,null,o.a.createElement(y.a,{variant:"connected"===this.props.status?"primary":"danger",type:"submit",disabled:"connected"!==this.props.status},"Send ",o.a.createElement(v.a,null)))))}}]),n}(o.a.Component);var b=function(e){var t=e.history.map((function(e,t){var n;return n="message"===e.type?o.a.createElement(o.a.Fragment,null,o.a.createElement("strong",null,e.from,": "),e.data.split("\n").map((function(e,t){return o.a.createElement(a.Fragment,{key:t},e,o.a.createElement("br",null))}))):"connection"===e.type?o.a.createElement(o.a.Fragment,null,"Started a connection with ",e.to):"disconnection"===e.type?o.a.createElement(o.a.Fragment,null,"Disconnection !"):o.a.createElement(o.a.Fragment,null,"Unknown content type !"),o.a.createElement("li",{key:e.id,className:e.type},n)}));return o.a.createElement("ul",{className:"chat-view",id:"chat-view"},t)};var g=function(e){var t=e.status,n=e.history,a=e.onSendData;return o.a.createElement("div",{className:"chat"},o.a.createElement(b,{history:n}),o.a.createElement(p,{status:t,onSubmit:function(e){return a(e)}}))},E=n(37),C=n(60),k=n(30),S=n(32);var D=function(e){var t=e.status,n=e.onConnect,c=e.onDisconnect,r=e.username,s=e.targetId,i=Object(a.useState)(""),u=Object(E.a)(i,2),l=u[0],h=u[1];return console.log(s),"connected"===t&&s&&s!==l&&h(s),o.a.createElement(d.a,{onSubmit:function(e){e.preventDefault(),n(l)}},"error"===t&&o.a.createElement(C.a,{variant:"danger"},"Error ! Are you sure this ID exists ?"),"connected"===t&&o.a.createElement(C.a,{variant:"success"},"You are connected to another user !"),"disconnected"===t&&o.a.createElement(C.a,{variant:"info"},"You are disconnected. Enter another user ID to start chatting."),o.a.createElement(k.a,null,o.a.createElement(S.a,null,"Your ID"),o.a.createElement(f.a,{type:"text",disabled:!0,value:r})),o.a.createElement(k.a,null,o.a.createElement(S.a,null,"Target ID"),o.a.createElement(f.a,{value:l,onChange:function(e){return h(e.target.value)},type:"text",disabled:"disconnected"!==t})),("disconnected"===t||"error"===t)&&o.a.createElement(y.a,{type:"submit"},"Connect to the target"),"loading"===t&&o.a.createElement(y.a,{type:"submit",disabled:!0},"Connecting ..."),"connected"===t&&o.a.createElement(y.a,{type:"submit",disabled:!0,variant:"success"},"Connected"),"connected"===t&&o.a.createElement(y.a,{type:"button",onClick:function(){return c()},variant:"danger"},"Disconnect"))},w=n(58),x=n(55),O=n(56),P=n(33),j=n(36),I=n.n(j),F=function(){function e(){var t=this;Object(s.a)(this,e),this.peer=new I.a,this.username="anonymous",this.conn=null,this.dataReceivedCb=function(){},this.changeUsernameCb=function(){},this.connectedCb=function(){},this.errorCb=function(){},this.disconnectedCb=function(){},this.peer.on("open",(function(e){return t.setUsername(e)})),this.peer.on("connection",(function(e){return t.setConnection(e)})),this.peer.on("disconnected",(function(){return t.disconnect()})),this.peer.on("close",(function(){return t.disconnect()})),this.peer.on("error",(function(e){console.error("Error PeerJS :",e),t.errorCb(e)}))}return Object(i.a)(e,[{key:"connect",value:function(e){var t=this;console.log("Connecting to ",e,"as",this.username);var n=this.peer.connect(e);return new Promise((function(e,a){n.on("open",(function(){t.setConnection(n),e()})),t.errorCb=a}))}},{key:"setUsername",value:function(e){console.log("Set username",e),this.username=e,this.changeUsernameCb(this.username)}},{key:"onChangeUsername",value:function(e){this.changeUsernameCb=e}},{key:"setConnection",value:function(e){var t=this;console.log("Connected to",e),this.conn=e,this.conn.on("data",(function(e){console.log("Data received:",e),t.dataReceivedCb(e)})),this.conn.on("error",(function(e){console.error("PeerJS Connection Error:",e),t.errorCb(e)})),this.conn.on("close",(function(){return t.disconnect()})),setTimeout((function(){return t.connectedCb(e)}),100)}},{key:"disconnect",value:function(){this.conn&&this.conn.open&&this.conn.close(),this.disconnectedCb()}},{key:"onConnected",value:function(e){this.connectedCb=e}},{key:"onDisconnected",value:function(e){this.disconnectedCb=e}},{key:"onDataReceived",value:function(e){this.dataReceivedCb=e}},{key:"send",value:function(e){console.log("Sending data:",e),this.conn.send(e)}},{key:"peerId",get:function(){return this.conn&&this.conn.open?this.conn.peer:null}}]),e}(),N=n(59),U=function(){function e(t){Object(s.a)(this,e),this.chatProxy=t}return Object(i.a)(e,[{key:"formatMessage",value:function(e){return{id:Object(N.a)(),type:"message",from:this.chatProxy.username,to:this.chatProxy.peerId,data:e}}},{key:"connection",value:function(){return{id:Object(N.a)(),type:"connection",from:this.chatProxy.username,to:this.chatProxy.peerId,data:""}}},{key:"disconnection",value:function(){return{id:Object(N.a)(),type:"disconnection",from:this.chatProxy.username,to:this.chatProxy.peerId,data:""}}}]),e}(),K=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={status:"disconnected",username:"anonymous",history:[]},a.chatProxy=new F,a.msgFormat=new U(a.chatProxy),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.chatProxy.onChangeUsername((function(t){return e.setState({username:t})})),this.chatProxy.onConnected((function(){return e.setState({status:"connected",history:e.state.history.concat([e.msgFormat.connection()])})})),this.chatProxy.onDisconnected((function(){return e.setState({status:"disconnected",history:e.state.history.concat([e.msgFormat.disconnection()])})})),this.chatProxy.onDataReceived((function(t){e.setState({history:e.state.history.concat([t])}),e.updateScroll()}))}},{key:"handleConnect",value:function(e){var t=this;this.setState({status:"loading"}),this.chatProxy.connect(e).then((function(){return t.setState({status:"connected"})})).catch((function(){return t.setState({status:"error"})}))}},{key:"handleDisconnect",value:function(){this.setState({status:"loading"}),this.chatProxy.disconnect()}},{key:"handleSendData",value:function(e){e=this.msgFormat.formatMessage(e),this.chatProxy.send(e),this.setState({history:this.state.history.concat([e])}),this.updateScroll()}},{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(w.a,{bg:"dark",expand:"lg",variant:"dark"},o.a.createElement(w.a.Brand,{href:"#home"},"Now Chat !")),o.a.createElement(x.a,{fluid:!0,className:"app"},o.a.createElement(O.a,{className:"h-100"},o.a.createElement(P.a,{md:"9",className:"chat-col"},o.a.createElement(g,{status:this.state.status,history:this.state.history,onSendData:function(t){return e.handleSendData(t)}})),o.a.createElement(P.a,{md:"3",className:"sidebar-col"},o.a.createElement(D,{status:this.state.status,username:this.chatProxy.username,targetId:this.chatProxy.peerId,onConnect:function(t){return e.handleConnect(t)},onDisconnect:function(t){return e.handleDisconnect(t)}})))))}},{key:"updateScroll",value:function(){setTimeout((function(){var e=document.getElementById("chat-view");e.scrollTop=e.scrollHeight}),100)}}]),n}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(K,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[38,1,2]]]);
//# sourceMappingURL=main.34c860f1.chunk.js.map