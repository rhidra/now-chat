(this["webpackJsonpnow-chat"]=this["webpackJsonpnow-chat"]||[]).push([[0],{38:function(e,t,n){e.exports=n(48)},43:function(e,t,n){},47:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=47},48:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(13),c=n.n(o),s=(n(43),n(10)),i=n(11),u=n(22),l=n(20),h=n(14),d=n(57),m=n(52),v=n(31),f=n(53),y=n(54),b=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={value:""},a.handleChange=a.handleChange.bind(Object(h.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(h.a)(a)),a.handleKeyDown=a.handleKeyDown.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.onSubmit(this.state.value),this.setState({value:""})}},{key:"handleKeyDown",value:function(e){"Enter"!==e.key||e.shiftKey||this.handleSubmit(e)}},{key:"render",value:function(){return r.a.createElement(d.a,{onSubmit:this.handleSubmit},r.a.createElement(m.a,null,r.a.createElement(v.a,{as:"textarea",rows:"3",value:this.state.value,onChange:this.handleChange,onKeyDown:this.handleKeyDown}),r.a.createElement(m.a.Append,null,r.a.createElement(f.a,{variant:"connected"===this.props.status?"primary":"danger",type:"submit",disabled:"connected"!==this.props.status},"Send ",r.a.createElement(y.a,null)))))}}]),n}(r.a.Component);var p=function(e){return r.a.createElement("ul",{className:"chat-view",id:"chat-view"},e.history.map((function(e,t){return r.a.createElement("li",{key:e.id},r.a.createElement("strong",null,e.from,": "),e.data.split("\n").map((function(e,t){return r.a.createElement(a.Fragment,{key:t},e,r.a.createElement("br",null))})))})))};var E=function(e){var t=e.status,n=e.history,a=e.onSendData;return r.a.createElement("div",{className:"chat"},r.a.createElement(p,{history:n}),r.a.createElement(b,{status:t,onSubmit:function(e){return a(e)}}))},g=n(37),C=n(60),S=n(30),k=n(32);var w=function(e){var t=e.status,n=e.onConnect,o=e.username,c=Object(a.useState)(""),s=Object(g.a)(c,2),i=s[0],u=s[1];return r.a.createElement(d.a,{onSubmit:function(e){e.preventDefault(),n(i)}},"error"===t&&r.a.createElement(C.a,{variant:"danger"},"Error ! Are you sure this ID exists ?"),"connected"===t&&r.a.createElement(C.a,{variant:"success"},"You are connected to another user ! Let's chat !"),r.a.createElement(S.a,null,r.a.createElement(k.a,null,"Your ID"),r.a.createElement(v.a,{type:"text",disabled:!0,value:o})),r.a.createElement(S.a,null,r.a.createElement(k.a,null,"Target ID"),r.a.createElement(v.a,{value:i,onChange:function(e){return u(e.target.value)},type:"text",disabled:"connected"===t})),("pending"===t||"error"===t)&&r.a.createElement(f.a,{type:"submit"},"Connect to the target"),"loading"===t&&r.a.createElement(f.a,{type:"submit",disabled:!0},"Connecting ..."),"connected"===t&&r.a.createElement(f.a,{type:"submit",disabled:!0,variant:"success"},"Connected"))},D=n(58),O=n(55),j=n(56),x=n(33),P=n(36),N=n.n(P),U=n(59),K=function(){function e(){var t=this;Object(s.a)(this,e),this.peer=new N.a,this.username="anonymous",this.conn=null,this.dataReceivedCb=function(){},this.changeUsernameCb=function(){},this.connectedCb=function(){},this.errorCb=function(){},this.peer.on("open",(function(e){return t.setUsername(e)})),this.peer.on("connection",(function(e){return t.setConnection(e)})),this.peer.on("error",(function(e){console.error("Error PeerJS :",e),t.errorCb(e)}))}return Object(i.a)(e,[{key:"connect",value:function(e){var t=this;console.log("Connecting to ",e,"as",this.username);var n=this.peer.connect(e);return new Promise((function(e,a){n.on("open",(function(){t.setConnection(n),e()})),t.errorCb=a}))}},{key:"setUsername",value:function(e){console.log("Set username",e),this.username=e,this.changeUsernameCb(this.username)}},{key:"onChangeUsername",value:function(e){this.changeUsernameCb=e}},{key:"setConnection",value:function(e){var t=this;console.log("Connected to",e),this.conn=e,this.conn.on("data",(function(e){console.log("Data received:",e),t.dataReceivedCb(e)})),this.connectedCb(e)}},{key:"onConnected",value:function(e){this.connectedCb=e}},{key:"onDataReceived",value:function(e){this.dataReceivedCb=e}},{key:"send",value:function(e){console.log("Sending data:",e),this.conn.send(e)}},{key:"preprocessData",value:function(e){return{id:Object(U.a)(),from:this.username,to:this.conn.peer,data:e}}}]),e}(),I=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={status:"pending",username:"anonymous",history:[]},a.chatProxy=new K,a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.chatProxy.onChangeUsername((function(t){return e.setState({username:t})})),this.chatProxy.onConnected((function(){return e.setState({status:"connected"})})),this.chatProxy.onDataReceived((function(t){e.setState({history:e.state.history.concat([t])}),e.updateScroll()}))}},{key:"handleConnect",value:function(e){var t=this;this.setState({status:"loading"}),this.chatProxy.connect(e).then((function(){return t.setState({status:"connected"})})).catch((function(){return t.setState({status:"error"})}))}},{key:"handleSendData",value:function(e){e=this.chatProxy.preprocessData(e),this.chatProxy.send(e),this.setState({history:this.state.history.concat([e])}),this.updateScroll()}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(D.a,{bg:"dark",expand:"lg",variant:"dark"},r.a.createElement(D.a.Brand,{href:"#home"},"Now Chat !")),r.a.createElement(O.a,{fluid:!0,className:"app"},r.a.createElement(j.a,{className:"h-100"},r.a.createElement(x.a,{md:"9",className:"chat-col"},r.a.createElement(E,{status:this.state.status,history:this.state.history,onSendData:function(t){return e.handleSendData(t)}})),r.a.createElement(x.a,{md:"3",className:"sidebar-col"},r.a.createElement(w,{status:this.state.status,username:this.chatProxy.username,onConnect:function(t){return e.handleConnect(t)}})))))}},{key:"updateScroll",value:function(){setTimeout((function(){var e=document.getElementById("chat-view");e.scrollTop=e.scrollHeight}),100)}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[38,1,2]]]);
//# sourceMappingURL=main.cdb214ab.chunk.js.map